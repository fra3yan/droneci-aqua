kind: pipeline
name: default

steps:
- name: scanner
  image: docker:dind
  volumes:
  - name: dockersock
    path: /var/run/docker.sock
  commands:
  #- sleep 5 # give docker enough time to start
  - docker ps -a
  - docker login registry.aquasec.com -u anggi.fp@netpoleons.com -p P@ssw0rd.alto
  - docker pull registry.aquasec.com/scanner:2022.4
  - docker run --rm -v /tmp:/tmp registry.aquasec.com/scanner:2022.4 --local docker:dind --host https://a23a3e4b89.cloud.aquasec.com/ --token 6f26ecbec88d8c45a244dd999a62f8c9440fad5b  --show-negligible --htmlfile out.html --jsonfile out.json > /dev/null

volumes:
- name: dockersock
  host:
    path: /var/run/docker.sock
